{% extends 'base.html' %}
{% block content %}
<style>
  @media print {
    @page {
      size: A4 landscape;
      margin: 1cm;
    }

    html, body {
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 1000px !important;
      margin: 0 auto !important;
      padding: 0 !important;
    }

    /* Hide non-print UI elements */
    .navbar, nav, .btn, a, .d-flex, .row, .col-md-8, .col-md-4 {
      display: none !important;
    }

    .table-responsive {
      margin: 0 auto;
    }
  }

  /* Center content in normal view */
  .container {
    margin-left: auto;
    margin-right: auto;
  }

  /* Table container for scroll on smaller screens */
  #equipmentReportTable {
    width: auto;
    border-collapse: collapse;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-size: 0.9rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    border-radius: 8px;
    overflow: hidden;
  }

  /* Table header */
  #equipmentReportTable thead th {
    border-color: #343a40 !important;
    background: linear-gradient(90deg, #343a40, #495057);
    color: #fff !important;
    font-weight: 600;
    text-align: center;
    padding: 0.75rem !important;
    border: 1px solid #343a40 !important;
  }

  /* Table body cells */
  #equipmentReportTable td {
    border: 1px solid #dee2e6 !important;
    padding: 0.6rem !important;
    text-align: center;
    vertical-align: middle;
  }

  /* Alternate row colors */
  #equipmentReportTable tbody tr:nth-child(odd) {
    background-color: #f8f9fa;
  }

  #equipmentReportTable tbody tr:nth-child(even) {
    background-color: #ffffff;
  }

  /* Hover effect */
  #equipmentReportTable tbody tr:hover {
    background-color: #e2e6ea;
    transition: background-color 0.2s ease-in-out;
  }

  /* Responsive: wrap table in scrollable container */
  @media (max-width: 768px) {
    #equipmentReportTable th,
    #equipmentReportTable td {
      font-size: 0.8rem;
      padding: 0.4rem !important;
    }
  }
</style>
<div class="container py-5" style="max-width: 1200px; margin: 0 auto;">
  <div class="d-flex justify-content-between align-items-center mb-4" style="margin-bottom: 2rem;">
    <a href="{{ url_for('admin.reports') }}" class="btn btn-secondary btn-sm" style="width: auto; padding: 0.25rem 0.5rem;"><i class="bi bi-arrow-left"></i> Back</a>
    <h3 class="text-info mb-0" style="text-align: center; flex: 1;">Total Equipment Report</h3>
    <div style="width: 85px;"></div><!-- Spacer for alignment -->
  </div>

  <div class="row mb-3">
    <div class="col-md-8">
      <form method="get" class="row g-2" action="{{ url_for('admin.equipment_report') }}">
        <div class="col-md-5">
          <input type="text" name="name" class="form-control" placeholder="Search by equipment name or code..." value="{{ search_name or '' }}">
        </div>
        <div class="col-md-5">
          <input type="text" name="category" class="form-control" placeholder="Search by category name..." value="{{ search_category or '' }}">
        </div>
        <div class="col-md-2">
          <button class="btn btn-primary w-100" type="submit"><i class="bi bi-search"></i> Search</button>
        </div>
        {% if search_name or search_category %}
          <div class="col-md-12">
            <a href="{{ url_for('admin.equipment_report') }}" class="btn btn-secondary w-100"><i class="bi bi-x-circle"></i> Clear Filters</a>
          </div>
        {% endif %}
      </form>
    </div>
    <div class="col-md-4 d-flex justify-content-end align-items-center">
        <div>
        <a href="{{ url_for('admin.equipment_report', name=search_name, category=search_category, export='csv') }}" class="btn btn-outline-secondary me-2">Export CSV</a>
        <!-- Print PDF will open the browser print dialog; user may choose 'Save as PDF' -->
        <button type="button" class="btn btn-outline-secondary" onclick="window.print()">Print PDF</button>
      </div>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-hover small" id="equipmentReportTable">
      <thead>
        <tr>
          <th>Category Name</th>
          <th>Equipment Name</th>
          <th>Category Code</th>
          <th>Total Quantity</th>
          <th>Available</th>
          <th>Issued</th>
          <th>Damaged</th>
          <th>Lost</th>
        </tr>
      </thead>
      <tbody>
        {% if equipments %}
          {% set grouped = equipments|groupby('category') %}
          {% for category, items in grouped %}
            {% for item in items %}
            <tr>
              {% if loop.first %}
                <td rowspan="{{ items|length }}"><strong>{{ item.category }}</strong></td>
              {% endif %}
              <td>{{ item.name }}</td>
              <td>{{ item.category_code }}</td>
              <td>{{ item.quantity }}</td>
              <td>{{ item.available_quantity }}</td>
              <td>{{ item.issued_count }}</td>
              <td>{{ item.damaged_count }}</td>
              <td>{{ item.lost_count }}</td>
            </tr>
            {% endfor %}
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="8" class="text-center text-muted">No equipment found.</td>
          </tr>
        {% endif %}
    </table>
  </div>
</div>
{% endblock %}