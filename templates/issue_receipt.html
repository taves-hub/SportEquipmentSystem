{% extends 'base.html' %}
{% block content %}

<div class="container" style="max-width:800px; padding-top:20px; padding-bottom:20px; position:relative;">

  <!-- ================= WATERMARK ================= -->
  <div style="
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) rotate(-30deg);
    font-size: 60px;
    font-weight: bold;
    color: rgba(0, 0, 0, 0.05);
    z-index: 0;
    pointer-events: none;
    white-space: nowrap;
  ">
    UNIVERSITY OF NAIROBI
  </div>
  <!-- ============================================ -->

  <!-- Foreground Content -->
  <div style="position: relative; z-index: 1;">

    <!-- ================= CENTERED HEADER ================= -->
    <div style="text-align:center; margin-bottom:14px;">

      <img
        src="{{ url_for('static', filename='pictures/uon_logo.jpg') }}"
        alt="University of Nairobi Logo"
        style="width:80px; height:auto; margin-bottom:6px;">

      <div style="font-size:18px; font-weight:bold; line-height:1.2;">
        University of Nairobi
      </div>

      <div style="font-size:16px; line-height:1.2;">
        Sports Department
      </div>

      <div style="margin-top:4px; font-size:15px; font-weight:bold; color:#0d6efd;">
        Equipment Issue Receipt
      </div>

      <hr style="border-top:1.8px solid #0d6efd; width:55%; margin:8px auto 0;">
    </div>
    <!-- =================================================== -->



    <!-- ================= RECEIPT IDENTITY ================= -->
    <div class="mb-2" style="width:100%; max-width:800px; margin:0 auto;">
      <div style="display:flex; justify-content:space-between; align-items:center; font-weight:600; font-size:1rem;">
        <div>
          Receipt No: <span class="text-dark">ISS-{{ '%04d' % issue.id }}</span>
        </div>
        <div>
          Date Issued: <span class="text-dark">{{ issue.date_issued.strftime('%d %b %Y, %H:%M') if issue.date_issued else '' }}</span>
        </div>
      </div>
      <hr style="border-top:1.2px solid #0d6efd; margin:6px 0 0 0;">
    </div>


    <!-- ================= RECIPIENT DETAILS ================= -->
<div class="mb-3 d-flex justify-content-center" style="page-break-inside:avoid; width:100%; max-width:800px; margin:0 auto;">
  <div style="width:100%; background:#ffffe0; padding:10px 12px; border-radius:6px;">

    <div class="fw-bold mb-2" style="font-size:1.05rem;">Issued To</div>

    <div style="
      display:grid;
      grid-template-columns: 1fr 1fr;
      column-gap: 40px;
      row-gap: 6px;
      font-size:0.95rem;
      line-height:1.2;
    ">

      <!-- Row 1 -->
      <div>
        Name of {{ 'Student' if issue.student else 'Staff' }}:
        <span style="border-bottom:1px dotted #333; min-width:200px; display:inline-block; margin-left:6px;">
          {{ issue.student.name if issue.student else issue.staff.name }}
        </span>
      </div>

      <div>
        {{ 'Course' if issue.student else 'Department' }}:
        <span style="border-bottom:1px dotted #333; min-width:160px; display:inline-block; margin-left:6px;">
          {% if issue.student and issue.student.course %}
            {{ issue.student.course }}
          {% elif issue.staff and issue.staff.department %}
            {{ issue.staff.department }}
          {% else %}
            &nbsp;
          {% endif %}
        </span>
      </div>

      <!-- Row 2 -->
      <div>
        Reg/Payroll No:
        <span style="border-bottom:1px dotted #333; min-width:160px; display:inline-block; margin-left:6px;">
          {{ issue.student_id if issue.student else issue.staff_payroll }}
        </span>
      </div>

      <div>
        Email:
        <span style="border-bottom:1px dotted #333; min-width:200px; display:inline-block; margin-left:6px;">
          {{ issue.student.email if issue.student else issue.staff.email }}
        </span>
      </div>

      <!-- Row 3 -->
      <div>
        Contact:
        <span style="border-bottom:1px dotted #333; min-width:160px; display:inline-block; margin-left:6px;">
          {{ issue.student.phone if issue.student and issue.student.phone else '' }}
        </span>
      </div>

      <div></div> <!-- keeps grid alignment clean -->

    </div>
  </div>
</div>


    <!-- ================= ISSUED EQUIPMENT ================= -->
    <div class="mb-4" style="page-break-inside: avoid;">
      <h5 class="fw-bold border-bottom pb-1 mb-2 text-center" style="color:#0d6efd;">
        Issued Equipment
      </h5>

      <div class="table-responsive">
        <table class="table table-bordered table-sm align-middle mb-0">
          <thead style="background:#0d6efd; color:#fff;">
            <tr>
              <th>Item Name</th>
              <th>Serial Number</th>
              <th>Condition at Issue</th>
            </tr>
          </thead>
          <tbody>
            {% if serials and serials|length > 0 %}
              {% for serial in serials %}
              <tr>
                <td>{{ issue.equipment.name if issue.equipment else issue.equipment_id }}</td>
                <td>{{ serial }}</td>
                <td>Good</td>
              </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td>{{ issue.equipment.name if issue.equipment else issue.equipment_id }}</td>
                <td>—</td>
                <td>Good</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>


    <!-- ================= ACKNOWLEDGEMENT ================= -->
    <div class="mb-4">
      <div class="alert alert-secondary py-2 px-3 mb-2 text-center" style="font-style:italic;">
        “I acknowledge receipt of the above equipment and agree to return them in the same condition,
        subject to institutional policies.”
      </div>
    </div>


    <!-- ================= SIGNATURES ================= -->
    <div class="row mt-4 mb-2" style="page-break-inside: avoid;">
      <div class="col-md-6 mb-3">
        <div class="fw-semibold mb-1">Recipient Signature:</div>
        <div style="height:40px; border-bottom:1.5px solid #333; width:80%; margin-bottom:8px;"></div>

        <div class="fw-semibold mb-1">Name:</div>
        <div style="min-height:24px;">
          {{ issue.student.name if issue.student else issue.staff.name }}
        </div>

        <div class="fw-semibold mb-1">Date:</div>
        <div style="height:20px; border-bottom:1.5px solid #333; width:50%;"></div>
      </div>

      <div class="col-md-6 mb-3">
        <div class="fw-semibold mb-1">Storekeeper Signature:</div>
        <div style="height:40px; border-bottom:1.5px solid #333; width:80%; margin-bottom:8px;"></div>

        <div class="fw-semibold mb-1">Name:</div>
        <div style="min-height:24px;">{{ storekeeper.name }}</div>

        <div class="fw-semibold mb-1">Date:</div>
        <div style="height:20px; border-bottom:1.5px solid #333; width:50%;"></div>
      </div>
    </div>


    <!-- ================= FOOTER ================= -->
    <div class="text-center mt-3" style="font-size:0.95rem; color:#888;">
      This receipt is system-generated. Keep it for your records.
    </div>

  </div>
</div>

{% endblock %}

