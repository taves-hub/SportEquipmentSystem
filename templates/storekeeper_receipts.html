{% extends 'base.html' %}
{% block content %}
<div class="container py-4">
  <h3 class="mb-4 text-center">Receipts</h3>
  <form method="get" class="mb-4">
    <div class="row g-2 justify-content-center">
      <div class="col-md-4">
        <input type="text" name="recipient_id" class="form-control" placeholder="Enter Student ID or Staff Payroll" value="{{ request.args.get('recipient_id', '') }}">
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100"><i class="bi bi-search"></i> Search</button>
      </div>
    </div>
  </form>
  {% if recipient and issues %}
    <div class="card mb-4">
      <div class="card-header bg-light">
        <strong>Receipts for {{ recipient.name }} ({{ recipient_id }})</strong>
      </div>
      <div class="card-body p-0">
        <table class="table table-sm mb-0">
          <thead class="table-light">
            <tr>
              <th>Receipt No</th>
              <th>Date Issued</th>
              <th>Equipment</th>
              <th>Quantity</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for issue in issues %}
            <tr>
              <td>ISS-{{ '%04d' % issue.id }}</td>
              <td>{{ issue.date_issued.strftime('%d %b %Y, %H:%M') if issue.date_issued else '' }}</td>
              <td>{{ issue.equipment.name if issue.equipment else issue.equipment_id }}</td>
              <td>{{ issue.quantity }}</td>
              <td><a href="{{ url_for('storekeeper.issue_receipt', issue_id=issue.id) }}" class="btn btn-outline-primary btn-sm" target="_blank"><i class="bi bi-receipt"></i> View</a></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% elif request.args.get('recipient_id') %}
    <div class="alert alert-warning text-center">No receipts found for ID: {{ request.args.get('recipient_id') }}</div>
  {% endif %}
</div>
{% endblock %}
